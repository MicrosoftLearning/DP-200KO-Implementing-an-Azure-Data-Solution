---
lab:
    title: 'Stream Analytics를 사용하여 실시간 분석 수행'
    module: '모듈 6: Stream Analytics를 사용하여 실시간 분석 수행'
---

# DP 200 - 데이터 플랫폼 솔루션 구현
# 랩 6 - Stream Analytics를 통해 실시간 분석 수행

**예상 시간**: 60분

**필수 구성 요소**: 이 랩 관련 사례 연구의 내용을 확인했으며, 모듈 1: 데이터 엔지니어용 Azure의 랩과 내용도 확인했다고 가정합니다.

**랩 파일**: 이 랩의 파일은 _Allfiles\Labfiles\Starter\DP-200.6_ 폴더에 있습니다.

## 랩 개요

학생들은 데이터 스트림이 무엇인지, 이벤트 처리가 어떻게 이루어지는지 설명하고 AdventureWorks 사례 연구에 적합한 데이터 스트림 수집 기술을 선택할 수 있습니다. 선택한 수집 기술을 프로비전하고 이를 Stream Analytics와 통합하여 스트리밍 데이터와 함께 작동하는 솔루션을 만듭니다.

## 랩 목표
  
이 랩을 완료하면 다음 작업을 수행할 수 있습니다.

1. 데이터 스트림 및 이벤트 처리 설명
1. Event Hubs를 사용하여 데이터 수집
1. Stream Analytics 작업으로 데이터 처리

## 시나리오
  
디지털 혁신 프로젝트의 일환으로 CIO가 마케팅 부서의 업무 생산성 개선 과정을 지원하라는 태스크를 배정했습니다. 지난 몇 년 동안 마케팅 부서는 Twitter를 사용하여 판매되는 자전거 제품을 중심으로 마케팅 메시지를 증폭시켰습니다. 

마케팅 부서는 캠페인 후 도달 번호를 제공할 수 있지만 볼륨을 수동으로 추적하기가 어렵기 때문에 누가 실시간으로 캠페인과 상호 작용하는지 이해할 수 없습니다. 따라서 캠페인에 응답하는 사람을 실시간으로 추적할 수 있는 시스템을 구현하려고 합니다.

이 랩을 마치면 다음 작업을 수행하는 방법을 배울 수 있습니다.

1. 데이터 스트림 및 이벤트 처리 설명
1. Event Hubs를 사용하여 데이터 수집
1. Stream Analytics 작업으로 데이터 처리

> **중요**: 이 랩을 진행하면서 프로비저닝 또는 구성 작업에서 발생한 문제를 기록하고 _\Labfiles\DP-200-Issues-Doc.docx에_있는 문서의 표에 기록합니다. 랩 번호를 문서화하고, 기술을 기록하며, 문제를 설명하고, 해결 방법이 무엇인지 설명합니다. 이 문서를 나중에 모듈에서 다시 참조할 때 저장합니다.

## 연습 1: 데이터 스트림 및 이벤트 처리 설명

예상 시간: 15분

그룹 연습
  
이 연습의 주요 태스크는 다음과 같습니다.

1. 사례 연구 및 시나리오에서 AdventureWorks의 데이터 스트림 수집 기술과 소셜 미디어 분석 요구 사항을 완료하기 위해 데이터 엔지니어로서 수행할 대략적인 태스크를 파악합니다.

1. 강사는 그룹과 결과에 대해 논의합니다.

### 태스크 1: AdventureWorks의 데이터 요구 사항 및 구조를 식별합니다.

1. 랩 가상 머신에서, **Microsoft Word**를 시작하고up the file **Allfiles\Labfiles\Starter\DP-200.6** 폴더의 **DP-200-Lab06-Ex01.docx** 파일을 엽니다.

1. 한 그룹으로 **10분**을 할애하여 데이터 요구 사항과 사례 연구 문서 내에서 그룹이 식별한 데이터 구조에 대해 논의하고 이를 나열합니다.

### 태스크 2: 강사와 조사 결과에 대해 토론합니다.

1. 강사는 결과를 논의하기 위해 그룹 토론을 중지합니다.

> **결과**: 이 연습을 완료한 후 데이터 스트리밍 수집 테이블과 소셜 미디어 분석 요구 사항을 완료하기 위해 데이터 엔지니어로 수행할 대략적인 태스크가 나와 있는 Microsoft Word 문서를 만들었습니다.

## 연습 2: 이벤트 허브를 사용하여 데이터 수집.
  
예상 시간: 15분

개인 연습
  
이 연습의 주요 태스크는 다음과 같습니다.

1. 이벤트 허브 네임스페이스를 만들고 구성합니다.

1. 이벤트 허브를 만들고 구성합니다.

1. 이벤트 허브 보안을 구성합니다.

### 태스크 1: 이벤트 허브 네임스페이스를 만들고 구성합니다.

1. Azure Portal에서 **리소스 만들기**를 선택하고 **Event Hubs**를 입력한 다음 검색 결과에서 **Event Hubs**를 선택합니다. 그런 다음 **만들기**를 선택합니다.

1. 네임스페이스 만들기 페이지에서 다음 옵션을 입력하고 **만들기**를 클릭합니다.
    - **이름**: xx-socialtwitter-eh, 여기서 xx는 이니셜
    - **가격 책정 계층**: 표준
    - **구독**: 사용자의 구독
    - **자원 그룹**: awrgstudxx
    - **장소**: 가장 가까운 위치를 선택합니다.
    - 다른 옵션을 기본 설정으로 남겨 둡니다.

    > **참고**: 이벤트 허브 네임스페이스를 만드는 데 약 1분이 걸립니다.

### 태스크 2: 이벤트 허브를 만들고 구성합니다.

1. Azure Portal의 블레이드에서 **리소스 그룹**을 클릭하고 **awrgstudxx**, **awdlsstudxx**를 차례로 클릭합니다. 여기서 **xx**는 이니셜입니다.

1. **xx-socialtwitter-eh**를 클릭합니다. 여기서 **xx**는 이니셜입니다.

1. **xx-socialtwitter-eh** 화면에서 **Event Hubs**를 클릭합니다.

1. 이름 **socialtwitter-eh**를 입력하고 **만들기**를 선택합니다.

    > **참고**: 약 10초 후에 이벤트 허브가 만들어졌다는 메시지가 표시됩니다.

### 태스크 3: 이벤트 허브 보안을 구성합니다.

1. **xx-socialtwitter-eh**의 Azure Portal에서 **xx**는 이니셜을 나타냅니다. 창 아래쪽으로 스크롤하고 **socialtwitter-eh** 이벤트 허브를 클릭합니다.

1. 이벤트 허브에 대한 액세스 권한을 부여하려면 **공유 액세스 정책**을 클릭합니다.

1. **socialtwitter-eh - 공유 액세스 정책** 화면에서 **추가**를 선택하여 **관리** 권한이 있는 정책을 만듭니다. 정책에 이름 **socialtwitter-eh-sap**을 지정하고 **관리**를 선택한 다음 **만들기**를 클릭합니다.

1. 정책이 만들어지면 새 정책 **socialtwitter-eh-sap**를 클릭한 다음 **연결 문자열 - 기본 키**의 복사 단추를 선택하고 연결 문자열 - 기본 키를 메모장에 붙여넣습니다. 이 값은 이 연습에서 나중에 필요합니다.

1. 포털에서 이벤트 허브 화면을 닫습니다.

> **결과**: 이 연습을 완료한 후 이벤트 허브 네임스페이스 내에서 Azure Event Hub를 만들고 서비스에 대한 액세스를 제공하는 데 사용할 수 있는 이벤트 허브에 대한 보안을 설정했습니다.

## 연습 3: Stream Analytics 작업으로 데이터 처리

예상 시간: 30분

개인 연습

이 연습의 주요 태스크는 다음과 같습니다.

1. Twitter 개발자 계정 만들기

1. Twitter 액세스 키 구성

1. Twitter 클라이언트 애플리케이션 구성 및 시작

1. Stream Analytics 작업 프로비저닝

1. Stream Analytics 작업 입력 지정

1. Stream Analytics 쿼리 정의

1. Stream Analytics 작업 출력 지정

1. Stream Analytics 쿼리 수정

1. Stream Analytics 작업 시작

1. 스트리밍 데이터 수집 검증

### 태스크 1: Twitter 개발자 계정을 만듭니다.

1. 브라우저에서 새 탭을 열어 https://developer.twitter.com/en/apps/로 이동하고 Twitter 계정으로 로그인하여 Twitter 앱을 설치합니다.

1. **앱** 페이지의 오른쪽에서 **앱 만들기** 단추를 클릭합니다.

1. "Twitter 계정을 신청하십시오"에서 **신청**을 클릭합니다.

1. '사용자 프로필' 페이지에서 Twitter 계정이 개발자 계정과 연결할 올바른 계정임을 확인하고 **계속**을 클릭합니다.

1. "계정 세부 정보" 페이지에서 "누가 액세스를 요청합니까?" 아래에서 **개인 용도로 액세스를 요청**을 클릭합니다. "계정 이름" 아래에서 ***twitter_name(으)로 코딩 학습***을 입력합니다. 마지막으로 **주 운영 국가**로 현재 거주 국가를 선택합니다. **계속**을 클릭합니다.

    > **참고**: 운영 국가의 모든 관련 법률 및 윤리를 준수해야 합니다.

1. "프로젝트에 대해 알려주세요" 페이지에서 "관심 있는 사용 사례"의 옵션을 선택합니다. 이 과정에서는 **학생**을 선택합니다. "무엇을 만들고 있는지 직접 설명해 주세요"에서 300단어 범위에서 사용 이유를 설명합니다. 다음은 예입니다.

> **참고**: 이 화면의 질문과 옵션은 바뀔 수 있습니다.

    >1. 저는 Twitter API를 사용하여 학습 애플리케이션에 Twitter 문을 포함하는 방법을 배우고 있습니다. 이 계정은 그 방법을 배우는 데 사용됩니다.
    >2.  학습의 일환으로 실시간으로 스트리밍 트윗을 계수하고 읽는 방법을 이해하기 위해 트윗을 분석할 계획입니다.
    >3. 리트윗 또는 콘텐츠 좋아하기의 형태로 다른 사람들의 트윗과 상호 작용할 의사가 없습니다. 트윗을 읽고, 계수하고, 감정을 확인할 것입니다.
    >4. 개별 및 집계 트윗은 모두 애플리케이션에서 분석됩니다. 

1. 마지막으로 질문 "귀하의 제품, 서비스 또는 분석에서 Twitter 콘텐츠 또는 파생 정보가 정부 기관에 제공됩니까?"에 대한 옵션을 선택한 다음 **계속**을 클릭합니다.

1. 서비스 약관을 읽고 동의할 경우 **수락**을 클릭합니다. 그런 다음 적합하다고 생각되는 확인란을 선택합니다. **신청서 제출**을 클릭합니다. 

1. 받은 편지함에서 확인 이메일을 확인하고 이메일에서 **이메일 확인**을 클릭하여 프로세스를 완료합니다.  그러면 Twitter 시작 화면으로 이동합니다.

### 태스크 2: Twitter 액세스 키 구성

1. Twitter 시작 화면이 아닌 경우 브라우저에서 새 탭을 열어 https://developer.twitter.com으로 이동한 다음 Twitter 계정으로 로그인합니다.

1. "시작" 또는 "앱" 페이지에서 **앱 만들기** 단추를 클릭합니다.

1. "앱 만들기" 페이지에서 다음 정보를 입력하고 **앱 만들기**를 클릭합니다.
    - **이름**: xx-social-app, 여기서 xx는 이니셜입니다.
    - **애플리케이션 설명**: "트윗을 수집하고 집계하는 데 사용"과 같은 설명을 추가합니다.
    - **웹 사이트 URL** 애플리케이션에 사용할 수 있는 개인 주소입니다.
    - **이 애플리케이션이 사용되는 방법을 알려주세요**: 앱이 스트리밍 데이터를 사용하는 방법을 배우기 위한 데모 앱이라는 것을 간략하게 설명하는 텍스트를 작성합니다.

1. 개발자 약관을 검토하고 **만들기**를 클릭합니다. 애플리케이션 이름을 제목으로 새 페이지가 나타납니다.

1. **키 및 토큰**이라는 페이지 탭을 클릭합니다.

1. 액세스 토큰 및 액세스 토큰 암호 아래에서 **만들기** 단추를 클릭합니다.

    >**참고**: 계정과 현재 애플리케이션에 대해 권한이 부여된 액세스 토큰 및 비밀이 생성됩니다.

1. 전에 열었던 메모장 파일에 다음 키를 복사합니다.
    - 소비자 키(API 키)
    - 소비자 비밀(API 비밀)
    - 액세스 토큰
    - 액세스 토큰 비밀

### 태스크 3: Twitter 클라이언트 애플리케이션 구성 및 시작

1. **Allfiles\Labfiles\Starter\DP-200.6\Twitter client\TwitterWPFClient\TwitterWPFClient** 위치에서 **TwitterWPFClient.exe** 애플리케이션을 두 번 클릭합니다. [여기에서 TwitterWPFClient](https://github.com/Azure/azure-stream-analytics/tree/master/Samples/TwitterClient)를 다운로드할 수도 있습니다.

1. 메모장에서 데이터를 TwitterWPFClient.exe 애플리케이션에 입력합니다.
    - **Twitter 소비자 키(API 키)**: Twitter 소비자 키
    - **Twitter 소비자 비밀(API 비밀)**: Twitter 소비자 비밀
    - **Twitter 액세스 토큰**: Twitter 액세스 토큰
    - **Twitter 액세스 비밀**: Twitter 액세스 비밀
    - **Azure EventHub 이름**: socialtwitter-eh.
    - **Azure Event Hub 연결 문자열**: Endpoint=sb://xx-socialtwitter-eh.servicebus.windows.net/;SharedAccessKeyName=xx-social-eh-sap;SharedAccessKey=<메모장에서 연결 문자열 - 기본 키 붙여넣기>  

        >**중요** 문자열 끝에서 REMOVE ;EntityPath=socialtwitter-eh를 제거하는 것이 중요합니다.

    - **검색 그룹**은 감정을 결정할 키워드를 정의합니다. 예를 들어 "#Brexit" 또는 brexit일 수 있고 쉼표로 구분된 여러 키워드를 추가할 수도 있습니다.

1. **TwitterWPFClient.exe**애플리케이션에서 **재생** 단추를 클릭하고 콘솔에 트윗이 표시될 때까지 기다렸다가 애플리케이션을 실행 상태로 둡니다.

      > **참고**: **TwitterWPFClient.exe** 애플리케이션은 정의된 검색어에 대해 날짜, 검색어 감정 점수, Twitter 이름 및 트윗 세부 사항을 캡처합니다. 

1. 모든 애플리케이션을 계속 실행합니다.

### 태스크 4: Stream Analytics 작업 프로비저닝

1. Azure Portal로 돌아가서 **리소스 만들기**를 선택하고 **STREAM**을 입력한 다음 **Stream Analytics 작업**을 클릭하고 **만들기**를 클릭합니다.
1. 
1. **새 Stream Analytics 작업** 화면에서 다음 세부 정보를 입력한 다음 **만들기**를 클릭합니다.
    - **작업 이름**: socialtwitter-asa-job.
    - **구독**: 기존 구독을 선택합니다.
    - **자원 그룹**: awrgstudxx
    - **위치**: 가장 가까운 위치를 선택합니다.
    - 다른 옵션을 기본 설정으로 남겨 둡니다.

    > **참고**: 약 10초 후에 Stream Analytics 작업이 만들어졌다는 메시지가 표시됩니다.

### 태스크 5: Stream Analytics 작업 입력 지정

1. Azure Portal의 블레이드에서 **리소스 그룹**을 클릭하고 **awrgstudxx**, **awdlsstudxx**를 차례로 클릭합니다. 여기서 **xx**는 이니셜입니다.

1. **socialtwitter-asa-job**을 클릭합니다.

1. **socialtwitter-asa-job** Stream Analytics 작업 창에서 **입력**을 클릭합니다.

1. **입력** 화면에서 **+ 스트림 입력 추가**를 클릭한 다음 **Event Hubs**를 클릭합니다.

1. 이벤트 허브 화면에서 다음 값을 입력하고 **저장** 단추를 클릭합니다.
    - **입력 별칭**: 이 작업 입력의 이름을 TwitterStream으로 입력합니다.
    - **구독에서 이벤트 허브 선택**: 확인됨
    - **구독**: 구독 이름
    - **이벤트 허브 네임스페이스**: xx-socialtwitter-eh
    - **이벤트 허브 이름**: 기존 이벤트 허브 socialtwitter-eh를 사용합니다.
    - **이벤트 허브 정책 이름**: socialtwitter-eh-sap
    - 나머지 옵션은 기본 설정으로 둡니다.

1. 값을 모두 입력하면 TwitterStream 입력 작업이 입력 창 아래에 표시됩니다. 입력 창을 닫고 Streaming Analytics 작업 페이지로 돌아갑니다.

### 태스크 6: Stream Analytics 작업 출력 지정

1. **socialtwitter-asa-job** Stream Analytics 작업 창에서 **출력**을 클릭합니다.

1. **출력 화면**에서 **추가**를 클릭한 다음 **Blob Storage**를 클릭합니다.

1. **Blob Storage** 창에서 창에 다음 값을 입력하거나 선택합니다.
- **출력 별칭**: 출력
- **구독에서 이벤트 허브 선택**: 확인됨
- **구독**: 구독 이름
- **스토리지 계정**: awsastudxx, 여기서 xx는 이니셜입니다.
- **컨테이너**: 기존 컨테이너 tweets을 선택합니다.

1. 나머지 항목은 기본값으로 둡니다. 마지막으로 **저장***을 클릭합니다.

1. 출력 창을 닫고 Streaming Analytics 작업 페이지로 돌아갑니다.

### 태스크 7: Stream Analytics 쿼리 정의

1. **socialtwitter-asa-job** 창 가운데의 **쿼리** 화면에서 **쿼리 편집**을 클릭합니다.

1. 코드 편집기에서 다음 쿼리를 대체합니다.

    ```SQL
    SELECT:
        *
    INTO
        [YourOutputAlias]
    FROM
        [YourInputAlias]
    ```

1. Replace with

    ```SQL
    SELECT: 
     [Topic]
    ,[SentimentScore]
    ,[created_at]
    ,[Author]
    ,[text]
    FROM [TwitterStream]
    ```

1. 저장을 선택합니다.

1. 쿼리 창을 닫고 Stream Analytics 작업 페이지로 돌아갑니다.


### 태스크 8: Stream Analytics 쿼리 정의

1. **socialtwitter-asa-job** 창 가운데의 **쿼리** 화면에서 **쿼리 편집**을 클릭합니다.

1. 코드 편집기에서 다음 쿼리를 대체합니다.

    ```SQL
    SELECT 
     [Topic]
    ,[SentimentScore]
    ,[created_at]
    ,[Author]
    ,[text]
    FROM [TwitterStream]
    ```

1. Replace with

    ```SQL
    SELECT 
     [Topic]
    ,[SentimentScore]
    ,[created_at]
    ,[Author]
    ,[text]
    INTO [Outputs]
    FROM [TwitterStream]
    ```

1. 저장을 선택합니다.

1. 쿼리 창을 닫고 Stream Analytics 작업 페이지로 돌아갑니다.

### 태스크 9: Stream Analytics 작업 시작

1. **socialtwitter-asa-job** 창 가운데의 **쿼리** 화면에서 **시작**을 클릭합니다.
 
1. **작업 시작** 대화 상자에서 **지금**을 클릭하고 **시작**을 클릭합니다. 

>**참고**: 1분이 지나면 **socialtwitter-asa-job** 창에서 작업이 시작되었다는 메시지가 표시되고 시작됨 필드가 시작된 시간으로 바뀝니다.

>**참고**: 데이터를 캡처할 수 있도록 2분 동안 실행합니다.

### 태스크 10: 스트리밍 데이터 수집 검증

1. Azure Portal의 블레이드에서 **리소스 그룹**을 클릭하고 **awrgstudxx**, **awsastudxx**를 차례로 클릭합니다. 여기서 **xx**는 이니셜입니다.

1. Azure Portal에서 **Blob** 화면을 클릭합니다.

1. Azure Portal에서 **awsastudxx - Blob** 화면의 목록에서 **tweets** 항목을 클릭합니다.

1. JSON 파일이 나타나는지 확인하고 크기 열을 확인합니다.

1. Microsoft Edge를 새로 고치고 화면이 새로 고쳐지면 파일 크기를 확인합니다.

    >**참고**: 파일을 다운로드하여 JSON 데이터를 쿼리할 수 있으며 Power BI에 데이터를 출력할 수도 있습니다.

> **결과**: 이 연습을 완료한 후 Azure Blob의 JSON 파일 저장소로 스트리밍 데이터를 수집하도록 Azure Stream Analytics를 구성했습니다. 이 작업에 스트리밍 Twitter 데이터를 사용했습니다.

## 마무리

1. Azure Portal의 블레이드에서 **리소스 그룹**을 클릭하고 **awrgstudxx**, **socialtwitter-asa-job**를 차례로 클릭합니다.

1. **socialtwitter-asa-job** 화면에서 **중지**를 클릭합니다. **스트리밍 작업 중지** 대화 상자에서 **예**를 클릭합니다.

1. **TwitterWPFClient.exe** 애플리케이션을 닫습니다.